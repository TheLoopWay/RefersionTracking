<!-- Squarespace Hybrid Solution - Uses HubSpot's native form with tracking -->
<!-- Add this as a Code Block -->

<!-- Container for HubSpot form -->
<div id="hubspot-form-container"></div>

<!-- Tracking Script -->
<script>
// Capture and store tracking
(function() {
    var rfsn = new URLSearchParams(window.location.search).get('rfsn');
    if (rfsn) {
        // Store in multiple ways for reliability
        document.cookie = 'rfsn=' + rfsn + '; max-age=2592000; path=/';
        try {
            localStorage.setItem('rfsn', rfsn);
            localStorage.setItem('rfsn_timestamp', new Date().toISOString());
            localStorage.setItem('rfsn_source_url', window.location.href);
        } catch(e) {}
        
        // Track with Refersion if available
        if (window.r) window.r('click', rfsn);
    }
})();
</script>

<!-- HubSpot Forms Script -->
<script charset="utf-8" type="text/javascript" src="//js-na2.hsforms.net/forms/v2.js"></script>
<script>
  hbspt.forms.create({
    region: "na2",
    portalId: "242518594",
    formId: "09ab75f6-bfbc-4d1c-8761-9ff764b650ca",
    target: "#hubspot-form-container",
    onFormReady: function($form) {
        // Get tracking data
        var rfsn = 
            new URLSearchParams(window.location.search).get('rfsn') ||
            (document.cookie.match(/rfsn=([^;]+)/) || [])[1] ||
            localStorage.getItem('rfsn');
            
        if (rfsn) {
            // Try to populate hidden fields
            var fields = [
                { name: 'refersionid', value: rfsn },
                { name: 'refersion_timestamp', value: localStorage.getItem('rfsn_timestamp') || new Date().toISOString() },
                { name: 'refersion_source_url', value: localStorage.getItem('rfsn_source_url') || window.location.href }
            ];
            
            fields.forEach(function(field) {
                // Try multiple selectors
                var input = $form.find('input[name="' + field.name + '"]').first() ||
                           $form.find('input[name*="' + field.name + '"]').first();
                           
                if (input.length) {
                    input.val(field.value);
                    input.trigger('change');
                }
            });
        }
    },
    onFormSubmit: function($form) {
        // Additional tracking on submit
        console.log('Form submitted with tracking');
    },
    onFormSubmitted: function() {
        // Clear form but keep tracking
        console.log('Form submission complete');
    }
  });
</script>

<style>
/* Optional: Style the HubSpot form to match your design */
#hubspot-form-container {
    max-width: 800px;
    margin: 0 auto;
    padding: 40px;
}

/* You can add more custom styles here to match your LOOP design */
</style>